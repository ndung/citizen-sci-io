<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layoutx :: layout (~{::body},'index')}">
<body>
<div class="kt-container-fluid">
    <div class="grid gap-5 lg:gap-7.5 xl:w-[48rem] mx-auto">
        <div class="kt-card pb-2.5">
            <div class="kt-card-header">
                <h3 class="kt-card-title" th:text="${q.id == null}? 'Create Question' : 'Edit Question'"></h3>
            </div>

            <form th:action="@{${q.id == null} ? '/questions' : '/questions/' + ${q.id}}"
                  th:object="${q}" method="post"
                  class="kt-card-content grid gap-5">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                <div class="flex items-baseline gap-2.5">
                    <label class="kt-form-label w-40">Sequence</label>
                    <input class="kt-input" type="number" th:field="*{sequence}"/>
                </div>

                <!-- simple fields -->
                <div class="flex items-baseline gap-2.5">
                    <label class="kt-form-label w-40">Attribute name</label>
                    <input class="kt-input" type="text" th:field="*{attribute}"/>
                </div>

                <div class="flex items-baseline gap-2.5">
                    <label class="kt-form-label w-40">Question</label>
                    <input class="kt-input" type="text" th:field="*{question}"/>
                </div>

                <div class="flex items-baseline gap-2.5">
                    <label class="kt-form-label w-40">Type</label>
                    <input class="kt-input" type="number" th:field="*{type}"/>
                </div>

                <div class="flex items-baseline gap-2.5">
                    <label class="kt-form-label w-40">Enabled</label>
                    <input type="checkbox" th:field="*{enabled}"/>
                </div>

                <div class="flex items-center gap-2.5">
                    <label class="kt-form-label w-40">Required</label>
                    <input type="checkbox" th:field="*{required}"/>
                </div>

                <!-- section dropdown -->
                <div class="flex items-baseline gap-2.5">
                    <label class="kt-form-label w-40">Section</label>
                    <select class="kt-input" th:field="*{sectionId}">
                        <option th:each="s : ${sections}" th:value="${s.id}" th:text="${s.name}"></option>
                    </select>
                </div>

                <!-- Parameter grid -->
                <div>
                    <label class="kt-form-label block mb-2">Parameters</label>
                    <table class="table border">
                        <thead><tr><th style="width:90px">Seq</th><th>Description</th></tr></thead>
                        <tbody>
                        <tr th:each="p, stat : *{parameters}">
                            <td>
                                <input class="kt-input" type="number" th:field="*{parameters[__${stat.index}__].sequence}" />
                            </td>
                            <td>
                                <input class="kt-input w-full" type="text"
                                       th:field="*{parameters[__${stat.index}__].description}" />
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <small>Add empty rows in controller (we added one) or via JS.</small>
                </div>

                <div class="flex justify-end gap-2">
                    <a th:href="@{/questions}" class="kt-btn">Cancel</a>
                    <button class="kt-btn kt-btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>
</body>
</html>
